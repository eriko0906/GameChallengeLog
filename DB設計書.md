# データベース設計案 v1.2

## 概要
このドキュメントは「ゲームチャレンジログ」アプリのデータベース構造を定義します。各テーブルのカラム、データ型、制約（主キー、非ヌル）を明記しています。

---

## 1. Users (ユーザー)
アプリのアカウントを持つユーザーの情報を保存します。

| カラム名 | データ型 | 説明 | 制約 |
| :--- | :--- | :--- | :--- |
| `user_id` | 文字列 | ユーザーを識別するユニークなID | **主キー**, NOT NULL |
| `name` | 文字列 | ユーザーの表示名 | NOT NULL |
| `icon_url` | 文字列 | プロフィールアイコン画像の保存場所 | NULL許可 |

---

## 2. Rooms (ルーム)
作成された各ルームの情報を保存します。

| カラム名 | データ型 | 説明 | 制約 |
| :--- | :--- | :--- | :--- |
| `room_id` | 文字列 | ルームを識別するユニークなID | **主キー**, NOT NULL |
| `name` | 文字列 | ルームの名前 | NOT NULL |

---

## 3. Players (プレイヤー)
ルームに参加している「プレイヤー」の情報を管理します。アプリユーザーもゲストも、このテーブルに登録されます。

| カラム名 | データ型 | 説明 | 制約 |
| :--- | :--- | :--- | :--- |
| `player_id` | 数値 | プレイヤーを識別するID | **主キー**, NOT NULL |
| `room_id` | 文字列 | どのルームに所属しているかを示すID | NOT NULL |
| `user_id` | 文字列 | 紐づく`Users`テーブルのID。ゲストの場合はNULL | NULL許可 |
| `guest_name` | 文字列 | ゲストの名前。アプリユーザーの場合はNULL | NULL許可 |
* **補足:** `user_id`と`guest_name`のどちらか一方は必ず値を持つ必要があります。

---

## 4. Games (ゲーム)
各ルームに登録されているゲームのリストを保存します。

| カラム名 | データ型 | 説明 | 制約 |
| :--- | :--- | :--- | :--- |
| `game_id` | 数値 | ゲームを識別するID | **主キー**, NOT NULL |
| `room_id` | 文字列 | どのルームのゲームリストかを示すID | NOT NULL |
| `name` | 文字列 | ゲームの名前 | NOT NULL |

---

## 5. Matches (対戦)
一回ごとの対戦の情報を保存します。

| カラム名 | データ型 | 説明 | 制約 |
| :--- | :--- | :--- | :--- |
| `match_id` | 数値 | 対戦を識別するID | **主キー**, NOT NULL |
| `room_id` | 文字列 | どのルームでの対戦かを示すID | NOT NULL |
| `game_id` | 数値 | どのゲームの対戦かを示すID | NOT NULL |
| `match_date` | 日付型 | 対戦が行われた日付 | NOT NULL |

---

## 6. MatchResults (対戦結果)
誰が勝ち、誰が負けたか、という具体的な結果を保存します。

| カラム名 | データ型 | 説明 | 制約 |
| :--- | :--- | :--- | :--- |
| `result_id` | 数値 | 結果を識別するID | **主キー**, NOT NULL |
| `match_id` | 数値 | どの対戦の結果かを示すID | NOT NULL |
| `player_id` | 数値 | どのプレイヤーの結果かを示すID | NOT NULL |
| `outcome` | 文字列 | 結果（例: "win", "loss"） | NOT NULL |

---

## 7. Penalties (ペナルティ)
発生したペナルティとその状態を保存します。

| カラム名 | データ型 | 説明 | 制約 |
| :--- | :--- | :--- | :--- |
| `penalty_id` | 数値 | ペナルティを識別するID | **主キー**, NOT NULL |
| `match_id` | 数値 | どの対戦で発生したペナルティかを示すID | NOT NULL |
| `assignee_player_id` | 数値 | 誰に割り当てられたペナルティかを示すID | NOT NULL |
| `description` | 文字列 | ペナルティの内容 | NOT NULL |
| `is_completed` | 真偽値 | 完了したかどうか (true/false) | NOT NULL |

---

## 8. PenaltyTemplates (ペナルティテンプレート)
各ルームで「リストから選択」できるペナルティの候補を保存します。

| カラム名 | データ型 | 説明 | 制約 |
| :--- | :--- | :--- | :--- |
| `template_id` | 数値 | テンプレートを識別するID | **主キー**, NOT NULL |
| `room_id` | 文字列 | どのルーム用のテンプレートかを示すID | NOT NULL |
| `description` | 文字列 | ペナルティの定型文 | NOT NULL |